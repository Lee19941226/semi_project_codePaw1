<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>입양후기 목록</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/review.css">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">
<link
	href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
	rel="stylesheet">

<style>
.like-icon {
	cursor: pointer;
	font-size: 23px;
	vertical-align: middle;
	color: #e57373;
}

.card {
	cursor: pointer;
	width: 250px;
	height: 200px;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
	background: #f9f9f9;
	border: 1px solid #ddd;
	border-radius: 8px;
}

.card img {
	max-width: 100%;
	max-height: 100%;
	object-fit: cover;
}

.card-info h3 {
	cursor: pointer;
}
</style>

</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="content">
		<section class="section">
			<div class="page-title">입양사진 및 후기</div>
			<div class="searchTitle">
				<form action="/review/searchTitle" method="get">
					<input type="text" name="searchTitle" placeholder="제목을 입력해주세요."> 
					<input type="hidden" name="reqPage" id="reqPage" value="1">
					<button type="submit">
						<span class="material-icons">search</span>
					</button>
				</form>
			</div>
			<hr class="border">
			<div class="all-review">
				<div class="all-card">
					<th:block th:each="review : ${list}">
						<th:block th:if="${list != '작성된 게시글이 존재하지 않습니다.'}">
						<div class="card-container">
							<div class="card" th:data-reviewNo="${review.reviewNo}">
								<img th:src="${review.thumbnail}" alt="후기 이미지">
							</div>
							<div class="card-info">
								<h3 class="review-title" th:data-reviewNo="${review.reviewNo}"
									th:text="${review.reviewTitle}"></h3>
								<span class="material-icons-outlined like-icon">favorite_border</span>
							</div>
							<p class="date" th:text="${review.reviewDate}"></p>
						</div>
						</th:block>
					</th:block>
					<th:block th:if ="${list =='작성된 게시글이 존재하지 않습니다.'}">
					<div class="write-btn-wrapper">
						<a th:if="${session.member != null and (session.member.memberLevel == 1 or session.member.memberLevel == 2)}"
							href="/review/reviewWriteFrm">
							<button class="write-btn">글쓰기</button>
						</a>
					</div>
					</th:block>
				</div>
			</div>
			<div id="pageNavi" th:utext="${pageNavi}"></div>
		</section>
	</main>
	<th:block th:include="common/footer"></th:block>

	<script>
	  document.addEventListener("DOMContentLoaded", function() {
	    const likeIcons = document.querySelectorAll(".like-icon");

	    likeIcons.forEach(icon => {
	      icon.addEventListener("click", function() {
	        if (this.textContent === "favorite_border") {
	          this.textContent = "favorite";   
	          this.classList.remove("material-icons-outlined");
	          this.classList.add("material-icons");
	        } else {
	          this.textContent = "favorite_border"; 
	          this.classList.remove("material-icons");
	          this.classList.add("material-icons-outlined");
	        }
	      });
	    });

	    // 카드 클릭 -> 상세 페이지 이동
	    document.querySelectorAll(".card").forEach(card =>{
	    	 card.addEventListener("click",function() {
	    		 const reviewNo = this.dataset.reviewno;
	    		 location.href= "/review/view?reviewNo=" + reviewNo;
	    	 })
	    });
	    
	    // 제목 클릭 -> 상세 페이지 이동
	    document.querySelectorAll(".review-title").forEach(title => {
	       title.addEventListener("click", function() {
	         const reviewNo = this.dataset.reviewno;
	         location.href = "/review/view?reviewNo=" + reviewNo;
	       });
	    });
	  });
	  
	  function likepush(reviewNo, obj) {
			console.log(reviewNo);
			const currentText = $(obj).text();
			//현재 텍스트(아이콘)에 따라서 좋아요 or 좋아요 취소 로직을 따로 처리 
			const isLike = (currentText === "favorite") ? 1 : 0;
			$.ajax({
				url : "/review/likepush",
				data : {
					reviewNo : reviewNo,
					isLike : isLike
				},
				type : "post",
				success : function(data) {
					console.log(data);
					if (isLike === 0) {
						$(obj).text("favorite");
					} else {
						$(obj).text("favorite_border");
					}

					$(obj).next().text(data);
				}
			})

		}
	 </script>
</body>
</html>
