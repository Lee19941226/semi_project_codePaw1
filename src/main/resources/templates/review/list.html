<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>입양후기 목록</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/review.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">

<style>
.like-box {
	display: inline-flex;
	align-items: center;
	gap: 3px; /* 숫자와 하트 사이 여백 */
	min-width: 35px; /* 항상 일정한 공간 확보 (밀림 방지) */
}

.like-count {
	font-size: 15px;
	color: #555;
}

.like-icon {
	cursor: pointer;
	font-size: 20px;
	vertical-align: middle;
	color: #e57373;
}

.card {
	cursor: pointer;
	width: 250px;
	height: 200px;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
	background: #f9f9f9;
	border: 1px solid #ddd;
	border-radius: 8px;
}

.card img {
	max-width: 100%;
	max-height: 100%;
	object-fit: cover;
}

.card-info {
	display: flex;
	align-items: center;
	justify-content: space-between; /* 제목 왼쪽, 좋아요 오른쪽 */
	margin-top: 5px;
}

.review-title {
	flex: 1;
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;
	cursor: pointer;
}

.write-btn-wrapper{
	widht: 1200px;
}

.border{
	width: 1100px;
	margin: 0 auto;
}

</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="content">
		<section class="section">
			<div class="page-title">입양사진 및 후기</div>
			<div class="searchTitle">
				<form class=search action="/review/searchTitle" method="get">
					<input type="text" name="searchTitle" placeholder="제목을 입력해주세요.">
					<input type="hidden" name="reqPage" id="reqPage" value="1">
					<button type="submit">
						<span class="material-icons">search</span>
					</button>
				</form>
			</div>
			<hr class="border">
			<div class="write-btn-wrapper"
					th:if="${session.member != null and (session.member.memberLevel == 1 || session.member.memberLevel == 2)}">
					<a href="/review/reviewWriteFrm">
						<button class="write-btn">작성하기</button>
					</a>
				</div>
			<div class="all-review">
				<div class="all-card">
					<th:block th:each="review : ${list}">
						<th:block th:if="${list != '작성된 게시글이 존재하지 않습니다.'}">
							<div class="card-container">
								<div class="card" th:data-reviewNo="${review.reviewNo}">
									<img th:src="${review.thumbnail}" alt="후기 이미지">
								</div>
								<div class="card-info">
									<h3 class="review-title" th:data-reviewNo="${review.reviewNo}"
										th:text="${#strings.length(review.reviewTitle) > 12 ? #strings.substring(review.reviewTitle, 0, 12) + '...' : review.reviewTitle}">
									</h3>

									<!-- 좋아요 영역 -->
									<div class="like-box" th:data-reviewNo="${review.reviewNo}"
										th:data-isLike="${review.isLike}"
										th:data-login="${session.member != null}">
										<span class="like-count" th:text="${review.likeCount}">0</span>
										<span class="material-icons like-icon">
											[[${review.isLike == 1 ? 'favorite' : 'favorite_border'}]] </span>
									</div>
								</div>
								<p class="date" th:text="${review.reviewDate}"></p>
							</div>
						</th:block>
					</th:block>
					<th:block th:if="${list =='작성된 게시글이 존재하지 않습니다.'}"></th:block>
				</div>
			</div>
			<div id="pageNavi" th:utext="${pageNavi}"></div>
		</section>
	</main>
	<th:block th:include="common/footer"></th:block>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
	$(document).on("click", ".like-icon", function() {
    const box = $(this).closest(".like-box");
    const icon = $(this);
    const reviewNo = box.data("reviewno");
    let isLike = parseInt(box.data("islike"));
    const isLogin = (box.data("login") === true || box.data("login") === "true");
    const countEl = box.find(".like-count");

    if (!isLogin) {
        swal("로그인 후 이용 가능합니다.", "", "warning")
            .then(() => {
                location.href = "/member/loginFrm";
            });
        return;
    }

    $.ajax({
        url: "/review/likepush",
        type: "post",
        data: { reviewNo: reviewNo, isLike: isLike },
        success: function(newCount) {
            if (isLike === 0) {
                icon.text("favorite");
                box.data("islike", 1);
            } else {
                icon.text("favorite_border");
                box.data("islike", 0);
            }
            countEl.text(newCount);
        },
        error: function(xhr, status, err) {
            console.error("좋아요 AJAX 실패:", status, err);
        }
    });
});

// 카드 클릭 -> 상세 페이지 이동
document.querySelectorAll(".card").forEach(card =>{
    card.addEventListener("click",function() {
        const reviewNo = this.dataset.reviewno;
        location.href= "/review/view?reviewNo=" + reviewNo;
    })
});

// 제목 클릭 -> 상세 페이지 이동
document.querySelectorAll(".review-title").forEach(title => {
    title.addEventListener("click", function() {
        const reviewNo = this.dataset.reviewno;
        location.href = "/review/view?reviewNo=" + reviewNo;
    });
});
</script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</body>
</html>
