<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입양가능한 아이 수정</title>
    <link rel="stylesheet" href="/css/writeFrm.css">
    <link rel="stylesheet" href="/summernote/summernote-lite.css">
</head>
<body>
    <th:block th:include="common/header"></th:block>

    <div class="container">
        <h2>입양가능한 아이 수정</h2>
        <hr>

        <form method="post" th:action="@{/mainAllpage/update}">
			
            <input type="hidden" name="protectNo" th:value="${ap.protectNo}" />

            <div class="header">
                <input type="text" id="title" name="protectTitle" th:value="${ap.protectTitle}" readonly />
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="name">동물이름</label>
                    <input type="text" id="name" name="animalName" th:value="${animal.animalName}" readonly />
                </div>
                <div class="form-group">
                    <label for="age">동물나이</label>
                    <input type="text" id="age" name="animalAge" th:value="${animal.animalAge}" readonly />
                </div>
            </div>

            <div class="content-box">
                <textarea id="content" name="protectContent" th:text="${ap.protectContent}"></textarea>
            </div>

            <div class="buttons">
                <a th:href="@{/mainAllpage/detail(protectNo=${ap.protectNo})}">
                    <button type="button">취소</button>
                </a>
                <button type="submit">수정하기</button>
            </div>
        </form>
    </div>

    <script src="/summernote/summernote-lite.js"></script>
    <script src="/summernote/lang/summernote-ko-KR.js"></script>
    <script>
    $('#content').summernote({
        height: 600,
        callbacks: {
            onImageUpload: function(files) {
                for (let i = 0; i < files.length; i++) {
                    uploadImage(files[i]);
                }
            }
        }
    });

    function uploadImage(file) {
        let formData = new FormData();
        formData.append("upfile", file);

        $.ajax({
            url: "/mainAllpage/editorImage",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            success: function(url) {
                $('#content').summernote('insertImage', url);
            },
            error: function(xhr, status, error) {
                console.log("AJAX 에러", status, error);
                alert("이미지 업로드 실패");
            }
        });
    }
    </script>

    <th:block th:include="common/footer"></th:block>
</body>
</html>
