<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="/css/notice.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
<style>
	.hidden{
		display: none;
	}
	#noticeTitle{
		width:500px;
		height: 28px;
		font-size: 26px;
		border: none;
		margin-bottom: 20px;
		text-align: left;
	}
	.title{
		margin-top: 20px;
	}
	
	.note-handle{
		display: none;
		border: none;
	}
	nput::-webkit-outer-spin-button,
	input::-webkit-inner-spin-button {
  		-webkit-appearance: none;
  		margin: 0;
	}
	.note-editor {
	  border: none ;
	  box-shadow: none ;
	}
	
	.note-editable {
	  resize: none ;
	  outline: none;
	}
	
	.note-resizebar {
	  display: none ;
	}
	button:hover>a{
		font-size: 16px;
		color: #ffffff;
		font-weight: 400;
	}
	.note-editor.note-frame, .note-editor.note-airframe{
		text-align: center;
	}
	.inline .del-btn{
	vertical-align : middle;
	font-size: 20px;
	color: #BB271A;
	cursor: pointer;
	}
	#noticeFiles{
		text-align: center;
		margin-left: 10px;
		font-size: 16px;
		width: 225px;
	}
	.file{
		display: inline-block;
	}
	.addFile{
		margin-left: 30px;
	}
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="content">
		<section class="section">
			<form action="/notice/update" method="post" enctype="multipart/form-data" class="form" autocomplete="off">
				<div class="title">
					<input type="hidden" name="noticeNo" id="noticeNo" th:value="${notice.noticeNo}">
					<input type="text" name="noticeTitle" id="noticeTitle" placeholder="제목을 입력해주세요." th:value="${notice.noticeTitle}">
				</div>
				<div class="line" th:text="${notice.memberId}"></div>
				<div class="line inline">
					<span class="file">첨부파일 |</span>
					<th:block th:each="file : ${notice.fileList}" class="file">
						<th:block th:if="${file != null}">
							<img src="/image/file.png" style="width: 16px;">
							<span class="deleteFilename" th:text="${file.filename}"></span>
							<span class="material-icons del-btn" th:onclick="deleteFile([[${file.noticeFileNo}]], this);">delete</span>
						</th:block>
						<th:block th:if="${file == null}">
							<span>없음</span>
						</th:block>
					</th:block>
					<span class="addFile">추가 파일 |</span>
					<input type="file" name="noticeFiles" id="noticeFiles" multiple>
				</div>
				<textarea name="noticeContent" id="noticeContent"></textarea>
				<p class="hidden" th:text="${notice.noticeContent}">
				<div class="line"> </div>
				<div class="btn-box">
					<button type="button" th:onclick="|location.href='@{/notice/view(noticeNo=${notice.noticeNo})}'|">취소하기</button>
					<button type="submit"id="submit">수정하기</button>
				</div>
			</form>
		</section>
	</main>
	<script src="/summernote/summernote-lite.js"></script>
	<script src="/summernote/lang/summernote-ko-KR.js"></script>
	<link rel="stylesheet" href="/summernote/summernote-lite.css">
	<script src="/js/sweetalert.min.js"></script>
	<script>
	
	$('#noticeContent').summernote({
	    height: 600,
	    toolbar: [
		    // [groupName, [list of button]]
		    ['fontname', ['fontname']],
		    ['fontsize', ['fontsize']],
		    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
		    ['color', ['forecolor','color']],
		    ['height', ['height']],
		    ['insert',['picture']],
		    ['view', ['help']]
		  ],
	    callbacks: {
	        onImageUpload: function(files) {
	            for (let i = 0; i < files.length; i++) {
	                uploadImage(files[i]);
	            }
	        }
	    }
	});
	const contentValue = $('.hidden').text();
	$('#noticeContent').summernote('code',contentValue);
	function uploadImage(file) {
	    let formData = new FormData();
	    formData.append("upfile", file);
		$.ajax({
		    url: "/notice/insertFrm/editorImage",
		    type: "POST",
		    data: formData,
		    contentType: false,
		    processData: false,
		    success: function(url) {
		        $('#noticeContent').summernote('insertImage', url);
		    },
		    error: function(xhr, status, error) {
		        console.log("AJAX 에러", status, error);
		        alert("이미지 업로드 실패");
		    }
		});
	}
	function deleteFile(noticeFileNo, obj){
		const input = $("<input>");
		input.attr("name","deleteFileNo");
		input.attr("type","hidden");
		input.val(noticeFileNo);
		$(".section>form").append(input);
		$(obj).parent().remove();
	}
	$("#submit").on('click',function(e){
		const content = $("#noticeTitle").val();
		if(content === ""){
			e.preventDefault(); // 전송 막기
		      swal({
		          title : "제목 확인",
		          text : "제목을 입력해주세요!",
		          icon : "warning",
		          buttons : {
		              confirm:{
		                  text: "확인",
		                  value: true,
		                  visible : true,
		                  className : "btn-swal-color",
		                  closeModal : true
		              }
		          }
		   		});
		}else {
            $(".form").submit();
        }
	});
	$("#submit").on('click',function(e){
		const content = $("#noticeContent").summernote('isEmpty');
		if(content){
			e.preventDefault(); // 전송 막기
		      swal({
		          title : "내용 확인",
		          text : "내용을 입력해주세요!",
		          icon : "warning",
		          buttons : {
		              confirm:{
		                  text: "확인",
		                  value: true,
		                  visible : true,
		                  className : "btn-swal-color",
		                  closeModal : true
		              }
		          }
		   		});
		}else {
            $(".form").submit();
        }
	});
	$('#noticeTitle').on("focus",function(){
		const noticeTitle = $("#noticeTitle");
		noticeTitle.attr("placeholder","");			
	});
	$('#noticeTitle').on("blur",function(){
		const noticeTitle = $("#noticeTitle");	
		noticeTitle.attr("placeholder","제목을 입력해주세요.");
	});
	</script>
	<th:block th:include="common/footer"></th:block>
</body>
</html>